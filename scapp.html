<html
    window-resizable="true"
    window-width="800dip"
    window-height="600dip"
>
<head>
<title>sciter promise demo</title>
<style>

@import url(vendor/8ctopus/sciter-logger/src/logger.css);

</style>
<script type="module">

import {logger} from "vendor/8ctopus/sciter-logger/src/logger.js";
import {addReloadWindow, centerWindow} from "vendor/8ctopus/sciter-utils/src/utils.js";

async function wait_async_await()
{
    const promise = new Promise(function(success, error) {
        setTimeout(function() {
            if (1 === 1)
                success("success");
            else
                error("failed");
        }, 2000);
    });

    console.log("Wait for promise...");

    try {
        const result = await promise;
        console.log(`Wait for promise - OK - ${result}`);
    }
    catch (error) {
        console.log(`Wait for promise - CATCH - ${error}`);
    }
}

function wait_then()
{
    const promise = new Promise(function(success, error) {
        setTimeout(function() {
            if (1 === 1)
                success("success");
            else
                error("failed");
        }, 2000);
    });

    console.log("Wait for promise...");

    promise.then(
        function success(result) {
            console.log(`Wait for promise - OK - ${result}`);
        },
        function error(result) {
            console.log(`Wait for promise - OK - ${result}`);
        }
    );
}

document.on("ready", function() {
    // initialize logger
    logger.init("", false);

    // subscribe to logger messages
    logger.subscribe(function(level, message) {
        const log = document.$("plaintext#logger");

        log.append(JSX(level, {}, [message]));

        // scroll to last item
        log.lastElementChild.scrollIntoView({behavior: "smooth"});
    });

    // attach logger to console
    logger.attach();

    // capture unhandled exceptions
    logger.capture();

    // add support for F5 reload
    addReloadWindow();

    // center window on screen
    centerWindow();

    console.log("Call wait...");

    // option 1
    wait_async_await();

    // option 2
    wait_then();

    console.log("Call wait - OK");

    // immediately invoked async function
    (async function() {
        await Promise.resolve(console.log("immediately invoked async function"));
    }());
});

</script>
</head>
<body>
    <plaintext #logger readonly />
</body>
</html>
